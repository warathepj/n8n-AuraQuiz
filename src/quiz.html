<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vibrant Quiz Game</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        .glow {
            box-shadow: 0 0 15px currentColor;
        }
        .option:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
        .option.correct {
            animation: pulse 0.5s 2;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 to-pink-700 min-h-screen flex items-center justify-center p-4">
    <h1 class="text-white text-4xl font-bold mb-8 absolute top-8 left-1/2 transform -translate-x-1/2">AuraQuiz</h1>
    <div class="w-full max-w-md">
        <!-- Quiz Header -->
        <div class="flex items-center justify-between mb-8">
            <div class="bg-yellow-400 text-purple-900 font-bold rounded-full w-12 h-12 flex items-center justify-center text-xl glow">
                <i class="fas fa-question"></i>
            </div>
            <div class="text-right">
                <p class="text-green-300 font-medium">Question</p>
                <p id="questionNumberDisplay" class="text-white text-2xl font-bold">1/1</p>
            </div>
            <div class="bg-blue-400 text-purple-900 font-bold rounded-full w-12 h-12 flex items-center justify-center text-xl glow">
                <i class="fas fa-star"></i>
            </div>
            <div class="text-right">
                <p class="text-green-300 font-medium">Score</p>
                <p id="scoreDisplay" class="text-white text-2xl font-bold">0</p>
            </div>
        </div>

        <!-- Quiz Card -->
        <div class="bg-white bg-opacity-10 backdrop-filter backdrop-blur-lg rounded-2xl p-6 glow" style="border: 1px solid rgba(255,255,255,0.2)">
            <!-- Question -->
            <div class="mb-8">
                <h2 id="questionText" class="text-white text-xl font-bold mb-2"></h2>
                <div class="h-1 bg-gradient-to-r from-pink-500 to-purple-500 rounded-full"></div>
            </div>

            <!-- Options -->
            <div id="optionsContainer" class="space-y-4">
                <!-- Options will be dynamically loaded here -->
            </div>

            <!-- Result Message -->
            <div id="resultMessage" class="hidden mt-6 p-4 rounded-xl text-white text-center font-bold"></div>

            <!-- Explanation Message -->
            <div id="explanationMessage" class="hidden mt-4 p-4 rounded-xl text-white text-center text-sm bg-blue-500 bg-opacity-30"></div>
        </div>

        <!-- Next Button -->
        <button id="nextBtn" onclick="nextQuestion()" class="hidden w-full mt-6 bg-gradient-to-r from-purple-500 to-pink-500 text-white py-3 rounded-xl font-bold tracking-wider glow hover:opacity-90 transition-all duration-200">
            Next Question
        </button>

        <!-- Create New Quiz Topic Button -->
        <button id="createNewQuizTopicBtn" onclick="createNewQuizTopic()" class="hidden w-full mt-4 bg-gradient-to-r from-blue-500 to-cyan-500 text-white py-3 rounded-xl font-bold tracking-wider glow hover:opacity-90 transition-all duration-200">
            Create New Quiz Topic
        </button>
    </div>

    <script>
        let quizData = null;
        let currentQuestionIndex = 0;
        let score = 0;

        async function initQuiz() {
            try {
                const response = await fetch('/api/quiz-data');
                quizData = await response.json();
                console.log('Quiz Data:', quizData);
                if (quizData && quizData.questions && quizData.questions.length > 0) {
                    currentQuestionIndex = 0;
                    score = 0;
                    document.getElementById('scoreDisplay').textContent = score;
                    renderQuestion(quizData.questions[currentQuestionIndex]);
                } else {
                    console.error('No quiz questions found.');
                    document.getElementById('questionText').textContent = 'No quiz available.';
                }
            } catch (error) {
                console.error('Error fetching quiz data:', error);
                document.getElementById('questionText').textContent = 'Error loading quiz.';
            }
        }

        function renderQuestion(question) {
            document.getElementById('questionNumberDisplay').textContent = `${currentQuestionIndex + 1}/${quizData.totalQuestions}`;
            document.getElementById('questionText').textContent = question.questionText;

            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = ''; // Clear previous options

            const optionColors = ['purple', 'pink', 'green', 'yellow']; // To maintain existing style

            question.options.forEach((optionText, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.classList.add(
                    'option',
                    `bg-${optionColors[index % optionColors.length]}-600`,
                    `hover:bg-${optionColors[index % optionColors.length]}-500`,
                    'text-white',
                    'rounded-xl',
                    'p-4',
                    'cursor-pointer',
                    'transition-all',
                    'duration-200',
                    'glow'
                );
                optionDiv.onclick = () => checkAnswer(optionDiv, optionText.charAt(0)); // Pass the option letter (A, B, C, D)

                optionDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="bg-white bg-opacity-20 rounded-lg w-8 h-8 flex items-center justify-center mr-3">
                            <span class="font-bold">${optionText.charAt(0)}</span>
                        </div>
                        <span>${optionText.substring(3)}</span>
                    </div>
                `;
                optionsContainer.appendChild(optionDiv);
            });
        }

        function checkAnswer(element, selectedOptionLetter) {
            // Disable all options
            document.querySelectorAll('.option').forEach(opt => {
                opt.style.pointerEvents = 'none';
            });

            const isCorrect = selectedOptionLetter === quizData.questions[currentQuestionIndex].correctAnswer;
            const resultMessage = document.getElementById('resultMessage');
            const explanationMessage = document.getElementById('explanationMessage');
            const nextBtn = document.getElementById('nextBtn');

            if (isCorrect) {
                score++;
                document.getElementById('scoreDisplay').textContent = score;
                element.classList.add('correct');
                element.classList.add('bg-green-500');
                resultMessage.textContent = 'Correct! ðŸŽ‰';
                resultMessage.classList.remove('hidden');
                resultMessage.classList.add('bg-green-500', 'bg-opacity-30');
            } else {
                element.classList.add('bg-red-500');
                resultMessage.textContent = 'Wrong answer! ðŸ˜¢';
                resultMessage.classList.remove('hidden');
                resultMessage.classList.add('bg-red-500', 'bg-opacity-30');
                
                // Highlight correct answer
                document.querySelectorAll('.option').forEach(opt => {
                    const optionLetter = opt.querySelector('span').textContent;
                    if (optionLetter === quizData.questions[currentQuestionIndex].correctAnswer) {
                        opt.classList.add('bg-green-500', 'correct');
                    }
                });
            }

            // Display explanation
            explanationMessage.textContent = quizData.questions[currentQuestionIndex].explanation;
            explanationMessage.classList.remove('hidden');

            nextBtn.classList.remove('hidden');
            nextBtn.textContent = (currentQuestionIndex < quizData.totalQuestions - 1) ? 'Next Question' : 'Show Score';
        }

        function nextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.totalQuestions) {
                // Reset UI for next question
                document.querySelectorAll('.option').forEach(opt => {
                    opt.style.pointerEvents = 'auto';
                    opt.classList.remove('bg-green-500', 'bg-red-500', 'correct');
                });
                document.getElementById('resultMessage').classList.add('hidden');
                document.getElementById('explanationMessage').classList.add('hidden');
                document.getElementById('nextBtn').classList.add('hidden');
                renderQuestion(quizData.questions[currentQuestionIndex]);
            } else {
                // Quiz finished, display final score
                document.getElementById('questionText').textContent = `Quiz Finished! Your score: ${score} / ${quizData.totalQuestions}`;
                document.getElementById('optionsContainer').innerHTML = ''; // Clear options
                document.getElementById('resultMessage').classList.add('hidden');
                document.getElementById('explanationMessage').classList.add('hidden');
                document.getElementById('nextBtn').textContent = 'Play Again';
                document.getElementById('nextBtn').onclick = resetQuiz;
                document.getElementById('createNewQuizTopicBtn').classList.remove('hidden'); // Show new quiz topic button
            }
        }

        function resetQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            document.getElementById('scoreDisplay').textContent = score;
            document.getElementById('nextBtn').onclick = nextQuestion; // Reset button action
            document.getElementById('nextBtn').textContent = 'Next Question'; // Reset button text
            document.getElementById('nextBtn').classList.add('hidden'); // Hide button initially
            document.getElementById('createNewQuizTopicBtn').classList.add('hidden'); // Hide new quiz topic button
            initQuiz(); // Re-initialize to fetch data and render first question
        }

        function createNewQuizTopic() {
            window.location.href = '/'; // Navigate to the root route
        }

        // Initialize the quiz when the page loads
        document.addEventListener('DOMContentLoaded', initQuiz);
    </script>
</body>
</html>
